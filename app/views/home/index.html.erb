
<% if Current.user.super %>
  <div class="flex justify-center mt-6">
    <%= button_to ' Revisar Vencimientos', check_all_expirations_path, method: :post, class: "px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-2xl shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50" %>
  </div>
<% end %>



<% @notifications.each do |notification| %>
  <div class="p-4 mb-4 border rounded-lg shadow-md mx-4 <%= notification_class(notification.notification_type) %>" role="alert">
    <div class="flex items-center">
      <svg class="flex-shrink-0 w-6 h-6 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 1 1 0 1v4h1a1 1 0 0 1 0 2Z"/>
      </svg>
      <h3 class="text-lg font-medium"><%= notification.title %></h3>
    </div>
    <div class="mt-2 mb-4 text-sm">
      <%= notification.text %>
    </div>
    <div class="flex">
      <%= link_to "Ver pendientes",
                  facturacions_path(notification_id: notification.id),
                  class: "text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-200 font-medium rounded-lg text-s px-3 py-3 me-2 text-center inline-flex items-center" %>
    </div>
  </div>
<% end %>




<% if Current.user.admin.nil? %>

  <section>


    <div class="py-4"></div>

    <%= render template: "facturacions/index" %>

  </section>

<% elsif !Current.user.admin.nil? && Current.user.gestion == true %>

  <nav class="bg-gray-800 p-4 text-white mb-6">
    <ul class="flex space-x-4 justify-center">
      <li class="<%= params[:tab] == 'cotizaciones' ? '' : 'border-b-2 border-blue-500' %>">
        <%= link_to "Inspecciones", home_path(tab: 'inspecciones'), class: "hover:underline" %>
      </li>
      <li class="<%= params[:tab] == 'cotizaciones' ? 'border-b-2 border-blue-500' : '' %>">
        <%= link_to "Cotizaciones", home_path(tab: 'cotizaciones'), class: "hover:underline" %>
      </li>
    </ul>
  </nav>

  <% if params[:tab] == 'cotizaciones' %>
    <section>



      <%= render template: "facturacions/index" %>

    </section>
  <% else %>
    <section>
      <div class="py-16 bg-gray-800">
        <div class="mx-auto px-6 max-w-6xl text-gray-200">
          <div class="text-center">
            <h1 class="text-4xl text-white font-bold mb-8">Inicio</h1>
          </div>
          <div class="mt-12 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <% if Current.user %>
              <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <div class="text-center">
                  <h3 class="text-lg font-semibold text-white">Inspecciones</h3>
                  <p class="text-sm text-gray-300 mt-2">Accede a las inspecciones disponibles.</p>
                  <div class="mt-4">
                    <%= link_to 'Inspecciones', inspections_path, class: "inline-block px-6 py-2 border border-blue-500 text-blue-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                  </div>
                </div>
              </div>
            <% end %>
            <% if Current.user.admin %>
              <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <div class="text-center">
                  <h3 class="text-lg font-semibold text-white">Programar Nueva Inspecci贸n</h3>
                  <p class="text-sm text-gray-300 mt-2">Crea una nueva inspecci贸n.</p>
                  <div class="mt-4">
                    <%= link_to 'Programar nueva inspecci贸n', new_inspection_path, class: "inline-block px-6 py-2 border border-green-500 text-green-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                  </div>
                </div>
              </div>
            <% end %>
            <% if Current.user.admin %>
              <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <div class="text-center">
                  <h3 class="text-lg font-semibold text-white">Certificaciones Vencidas y por Vencer</h3>
                  <p class="text-sm text-gray-300 mt-2">Revisa los activos que necesitan renovar su certificaci贸n.</p>
                  <div class="mt-4">
                    <%= link_to 'Certificaciones por vencer', warnings_path, class: "inline-block px-6 py-2 border border-red-500 text-red-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                  </div>
                </div>
              </div>
            <% end %>
            <% if Current.user.admin %>
              <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <div class="text-center">
                  <h3 class="text-lg font-semibold text-white">Clasificaciones</h3>
                  <p class="text-sm text-gray-300 mt-2">Administra los diferentes tipos de activos.</p>
                  <div class="mt-4">
                    <%= link_to "Clasificaciones", groups_path, class: "inline-block px-6 py-2 border border-purple-500 text-purple-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                  </div>
                </div>
              </div>
            <% end %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Empresas</h3>
                <p class="text-sm text-gray-300 mt-2">Consulta las empresas registradas como clientes.</p>
                <div class="mt-4">
                  <%= link_to "Empresas", principals_path, class: "inline-block px-6 py-2 border border-yellow-500 text-yellow-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
            <% if Current.user %>
              <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <div class="text-center">
                  <h3 class="text-lg font-semibold text-white">Activos</h3>
                  <p class="text-sm text-gray-300 mt-2">Gestiona los activos disponibles.</p>
                  <div class="mt-4">
                    <%= link_to "Activos", items_path, class: "inline-block px-6 py-2 border border-blue-500 text-blue-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </section>

    <% if @inspections.count > 0 %>
      <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 my-8">
        <div class="bg-gray-800 shadow overflow-hidden sm:rounded-md">
          <div class="bg-gray-900 py-6 px-8 shadow-lg rounded-lg text-center">
            <h1 class="text-2xl font-bold text-white">Inspecciones Abiertas</h1>
            <p class="text-gray-400">Consulta las inspecciones en curso.</p>
          </div>
          <%= turbo_frame_tag 'inspections' do %>
            <div class="p-6">
              <% if Current.user.tabla %>
                <div class="overflow-x-auto table-responsive mt-6">
                  <table id="inspections-table" class="table-auto w-full text-white">
                    <thead class="bg-gray-800">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">N掳 Inspecci贸n</p>
                      </th>

                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Nombre</p>
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Activo</p>
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Empresa</p>
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Fecha Inspecci贸n</p>
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Resultado</p>
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Tiempo en<br>resultado actual</p>
                      </th>

                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Inspector asignado</p>
                      </th>

                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700 relative group">
                        <p class="hover:text-blue-700">Estado</p>
                        <span class="absolute top-full left-1/2 transform -translate-x-1/2 mt-1 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md z-10">
                          Opciones: Atrasada, Hoy, Pr贸xima
                        </span>
                      </th>

                      <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                        <p class="hover:text-blue-700">Acciones</p>
                      </th>
                    </tr>
                    </thead>
                    <tbody class="bg-gray-700 divide-y divide-gray-600">
                    <% @inspections.each do |inspection| %>
                      <tr class="bg-gray-800 border-b border-gray-700">
                        <td class="px-6 py-4 whitespace-normal break-words">
                          <strong class="text-white">
                            <%= link_to inspection.number,
                                        inspection_path(inspection),
                                        data: { turbo_frame: "_top" },
                                        class: "text-blue-400 hover:text-blue-600" %>
                          </strong>
                        </td>

                        <td class="px-6 py-4 whitespace-normal break-words">
                          <strong class="text-white">
                            <%= link_to inspection.name,
                                        inspection_path(inspection),
                                        data: { turbo_frame: "_top" },
                                        class: "text-blue-400 hover:text-blue-600" %>
                          </strong>
                        </td>

                        <td class="px-6 py-4 whitespace-normal break-words">
                          <%= link_to inspection.item&.identificador, item_path(inspection.item), data: { turbo_frame: "_top" }, class: "text-blue-400 hover:text-blue-600" %>
                        </td>
                        <td class="px-6 py-4 whitespace-normal break-words">
                          <%= link_to inspection.item&.principal&.name, principal_path(inspection.item.principal), data: { turbo_frame: "_top" }, class: "text-blue-400 hover:text-blue-600" %>
                        </td>
                        <!-- Inspecci贸n con data-order para ordenamiento -->
                        <td class="px-6 py-4 whitespace-normal break-words" data-order="<%= inspection.ins_date.strftime('%Y%m%d') %>">
                          <p class="text-white"><%= format_date(inspection.ins_date) %></p>
                        </td>
                        <td class="px-6 py-4 whitespace-normal break-words">
                          <p class="text-white"><%= inspection.result %></p>
                        </td>
                        <!-- Cambio de d铆as -->
                        <td class="px-6 py-4 whitespace-normal break-words" data-order="<%= (Date.current - inspection.cambio).to_i %>">
                          <p class="text-white">
                            <%= (Date.current - inspection.cambio).to_i == 1 ? "1 d铆a" : "#{(Date.current - inspection.cambio).to_i} d铆as" %>
                          </p>
                        </td>
                        <!-- Usuarios -->
                        <td class="px-6 py-4 whitespace-normal break-words">
                          <% if inspection.users.any? %>
                            <ul>
                              <% inspection.users.each do |user| %>
                                <li class="text-white"><%= user.real_name %></li>
                              <% end %>
                            </ul>
                          <% else %>
                            <p class="text-gray-400">No asignado</p>
                          <% end %>
                        </td>
                        <!-- Estado de la inspecci贸n -->
                        <td class="px-6 py-4 whitespace-normal break-words text-center" data-order="<%= inspection.ins_date %>">
                          <div class="relative group">
                            <% if inspection.ins_date < Date.today %>
                              <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                                <circle cx="12" cy="12" r="5" fill="red" />
                              </svg>
                              <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
              Inspecci贸n Atrasada
            </span>
                            <% elsif inspection.ins_date == Date.today %>
                              <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                                <circle cx="12" cy="12" r="5" fill="green" />
                              </svg>
                              <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
              Agendada para hoy
            </span>
                            <% else %>
                              <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                                <circle cx="12" cy="12" r="5" fill="yellow" />
                              </svg>
                              <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
              Agendada para <%= format_date(inspection.ins_date) %>
            </span>
                            <% end %>
                          </div>
                        </td>
                        <!-- Acci贸n -->
                        <td class="px-6 py-4">
                          <%= link_to "Ver inspecci贸n", inspection_path(inspection), class: "text-blue-400 hover:text-blue-600", data: { turbo_frame: "_top" } %>
                        </td>
                      </tr>
                    <% end %>
                    </tbody>
                  </table>
                </div>
                <script>
                    document.addEventListener("turbo:load", function() {
                        const tableEl = document.getElementById("inspections-table");
                        if (
                            tableEl &&
                            typeof simpleDatatables !== "undefined" &&
                            simpleDatatables.DataTable
                        ) {
                            const dataTable = new simpleDatatables.DataTable("#inspections-table", {
                                labels: {
                                    placeholder: "Buscar...",
                                    perPage: "registros por p谩g.",
                                    noRows: "No hay datos para mostrar",
                                    noResults: "No hay resultados que coincidan con tu b煤squeda",
                                    info: "Mostrando {start} a {end} de {rows} entradas"
                                },
                                tableRender: (_data, table, type) => {
                                    if (type === "print") {
                                        return table;
                                    }
                                    table.childNodes[0].childNodes.forEach((row) => {
                                        if (!row.attributes) row.attributes = {};
                                        row.attributes.class = (row.attributes.class || "") + " bg-gray-800 text-white";
                                        row.childNodes.forEach((th) => {
                                            if (!th.attributes) th.attributes = {};
                                            th.attributes.class = (th.attributes.class || "") + " bg-gray-800 text-white";
                                        });
                                    });
                                    const tHead = table.childNodes[0];
                                    const firstRow = tHead.childNodes[0];
                                    const filterHeaders = {
                                        nodeName: "TR",
                                        attributes: {
                                            class: "search-filtering-row bg-gray-800 text-white",
                                        },
                                        childNodes: firstRow.childNodes.map((_th, index) => ({
                                            nodeName: "TH",
                                            attributes: {
                                                style: "padding-top: 1rem;"
                                            },
                                            childNodes: [
                                                {
                                                    nodeName: "INPUT",
                                                    attributes: {
                                                        class: "datatable-input text-white placeholder-gray-400 bg-gray-700 border-gray-600 w-full",
                                                        type: "search",
                                                        "data-columns": "[" + index + "]",
                                                        placeholder: "Filtrar"
                                                    }
                                                }
                                            ]
                                        }))
                                    };
                                    tHead.childNodes.push(filterHeaders);
                                    return table;
                                }
                            });
                        }
                    });
                </script>
                <style>
                    .dataTable-table tbody td {
                        color: #fff !important;
                    }
                    .datatable-ascending,
                    .datatable-descending {
                        background-color: #539DED !important;
                        color: #fff !important;
                    }

                    #inspections-table thead th button.datatable-sorter {
                        background: transparent !important;
                        border: none !important;
                        color: #fff !important;
                    }

                    #inspections-table thead th button.datatable-sorter:hover {
                        background: transparent !important;
                        color: #1d4ed8 !important;
                    }

                    #inspections-table thead th button.datatable-sorter:hover::before,
                    #inspections-table thead th button.datatable-sorter:hover::after {
                        background-color: transparent !important;
                        color: #1d4ed8 !important;
                    }

                    #inspections-table thead th button.datatable-sorter:hover p.hover\:text-blue-700 {
                        color: #1d4ed8 !important;
                    }
                    #inspections-table .datatable-selector {
                        background-color: #f2f2f2 !important;
                        color: #000 !important;
                        border: 1px solid #ccc !important;
                        border-radius: 4px;
                        padding: 0.25rem 0.5rem;
                    }
                    #inspections-table .datatable-input {
                        background-color: #f2f2f2 !important;
                        color: #000 !important;
                        border: 1px solid #ccc !important;
                        border-radius: 4px;
                        padding: 0.25rem 0.5rem;
                    }
                    #inspections-table .datatable-input::placeholder {
                        color: #888;
                    }
                </style>
              <% else %>
                <%= render 'shared/search_form', form_url: home_path, search_keys: 'number_eq', frame_id: 'inspections', placeholder_text: 'n煤mero de inspecci贸n' %>

                <%= turbo_frame_tag "inspections-#{@pagy.page}", class: 'inspections' do %>
                  <ul class="divide-y divide-gray-700">
                    <% @inspections.each_with_index do |inspection, index| %>
                      <li class="<%= 'bg-gray-700' if index.even? %> p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-150 ease-in-out">
                        <% border_class =
                             if inspection.ins_date < Date.today
                               "border border-red-600"
                             elsif inspection.ins_date == Date.today
                               "border border-green-500"
                             else
                               "border border-yellow-500"
                             end
                        %>
                        <div id="<%= dom_id inspection %>" class="max-w-md mx-auto bg-gray-900 rounded-xl shadow-lg overflow-hidden md:max-w-2xl <%= border_class %>">
                          <div class="p-8">
                            <p class="text-gray-400">
                              <strong class="text-gray-200 text-4xl">Inspecci贸n N掳: <%= inspection.number %></strong>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200 text-2xl">
                                Activo:
                                <%= link_to inspection.item&.identificador, item_path(inspection.item), class:"text-blue-500", data: { turbo_frame: "_top" } %>
                              </strong>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Empresa:</strong>
                              <%= link_to inspection.item&.principal&.name, principal_path(inspection.item.principal), class:"text-blue-500", data: { turbo_frame: "_top" } %>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Fecha de la inspecci贸n:</strong>
                              <%= format_date(inspection.ins_date) %>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Periodicidad:</strong>
                              <%= display_periodicity(inspection.validation) %>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Clasificaci贸n:</strong>
                              <%= inspection.item&.group&.name %>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Resultado de la inspecci贸n:</strong>
                              <%= inspection.result %>
                            </p>
                            <p class="text-gray-400">
                              <strong class="text-gray-200">Fecha de t茅rmino certificaci贸n:</strong>
                              <%= format_date(inspection.report&.ending) %>
                            </p>
                            <div class="mt-4">
                              <% if (controller_name == 'inspections' && action_name == 'index') ||
                                (controller_name == 'users' && action_name == 'show') ||
                                (controller_name == 'static_pages') ||
                                (controller_name == "home") %>
                                <%= link_to 'Ver inspecci贸n', inspection_path(inspection), class: "inline-block px-6 py-2 border border-blue-800 text-blue-400 font-medium text-xs leading-tight uppercase rounded hover:bg-blue-800 hover:text-white focus:outline-none focus:ring-0 transition duration-150 ease-in-out", 'data-turbo-frame': "_top" %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </li>
                    <% end %>
                  </ul>
                  <% if @pagy.next %>
                    <%= turbo_frame_tag "inspections-#{@pagy.next}", class: 'inspections', src: pagy_url_for(@pagy, @pagy.next), loading: :lazy %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>

<% else %>

  <section>
    <div class="py-16 bg-gray-800">
      <div class="mx-auto px-6 max-w-6xl text-gray-200">
        <div class="text-center">
          <h1 class="text-4xl text-white font-bold mb-8">Inicio</h1>
        </div>
        <div class="mt-12 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <% if Current.user %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Inspecciones</h3>
                <p class="text-sm text-gray-300 mt-2">Accede a las inspecciones disponibles.</p>
                <div class="mt-4">
                  <%= link_to 'Inspecciones', inspections_path, class: "inline-block px-6 py-2 border border-blue-500 text-blue-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
          <% end %>
          <% if Current.user.admin %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Programar Nueva Inspecci贸n</h3>
                <p class="text-sm text-gray-300 mt-2">Crea una nueva inspecci贸n.</p>
                <div class="mt-4">
                  <%= link_to 'Programar nueva inspecci贸n', new_inspection_path, class: "inline-block px-6 py-2 border border-green-500 text-green-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
          <% end %>
          <% if Current.user.admin %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Certificaciones Vencidas y por Vencer</h3>
                <p class="text-sm text-gray-300 mt-2">Revisa los activos que necesitan renovar su certificaci贸n.</p>
                <div class="mt-4">
                  <%= link_to 'Certificaciones por vencer', warnings_path, class: "inline-block px-6 py-2 border border-red-500 text-red-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
          <% end %>
          <% if Current.user.admin %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Clasificaciones</h3>
                <p class="text-sm text-gray-300 mt-2">Administra los diferentes tipos de activos.</p>
                <div class="mt-4">
                  <%= link_to "Clasificaciones", groups_path, class: "inline-block px-6 py-2 border border-purple-500 text-purple-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
          <% end %>
          <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
            <div class="text-center">
              <h3 class="text-lg font-semibold text-white">Empresas</h3>
              <p class="text-sm text-gray-300 mt-2">Consulta las empresas registradas como clientes.</p>
              <div class="mt-4">
                <%= link_to "Empresas", principals_path, class: "inline-block px-6 py-2 border border-yellow-500 text-yellow-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
              </div>
            </div>
          </div>
          <% if Current.user %>
            <div class="group overflow-hidden p-8 rounded-xl bg-gray-900 shadow-lg border border-gray-700 hover:shadow-xl transition-shadow duration-300 ease-in-out">
              <div class="text-center">
                <h3 class="text-lg font-semibold text-white">Activos</h3>
                <p class="text-sm text-gray-300 mt-2">Gestiona los activos disponibles.</p>
                <div class="mt-4">
                  <%= link_to "Activos", items_path, class: "inline-block px-6 py-2 border border-blue-500 text-blue-500 font-medium text-xs leading-tight uppercase rounded hover:bg-black hover:bg-opacity-3 focus:outline-none focus:ring-0 transition duration-150 ease-in-out" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </section>

  <% if @inspections.count > 0 %>
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 my-8">
      <div class="bg-gray-800 shadow overflow-hidden sm:rounded-md">
        <div class="bg-gray-900 py-6 px-8 shadow-lg rounded-lg text-center">
          <h1 class="text-2xl font-bold text-white">Inspecciones Abiertas</h1>
          <p class="text-gray-400">Consulta las inspecciones en curso.</p>
        </div>
        <%= turbo_frame_tag 'inspections' do %>
          <div class="p-6">
            <% if Current.user.tabla %>
              <div class="overflow-x-auto table-responsive mt-6">
                <table id="inspections-table" class="table-auto w-full text-white">
                  <thead class="bg-gray-800">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">N掳 Inspecci贸n</p>
                    </th>

                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Nombre</p>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Activo</p>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Empresa</p>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Fecha Inspecci贸n</p>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Resultado</p>
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Tiempo en<br>resultado actual</p>
                    </th>

                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Inspector asignado</p>
                    </th>

                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700 relative group">
                      <p class="hover:text-blue-700">Estado</p>
                      <span class="absolute top-full left-1/2 transform -translate-x-1/2 mt-1 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md z-10">
                        Opciones: Atrasada, Hoy, Pr贸xima
                      </span>
                    </th>

                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider hover:text-blue-700">
                      <p class="hover:text-blue-700">Acciones</p>
                    </th>
                  </tr>
                  </thead>
                  <tbody class="bg-gray-700 divide-y divide-gray-600">
                  <% @inspections.each do |inspection| %>
                    <tr class="bg-gray-800 border-b border-gray-700">
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <strong class="text-white">
                          <%= link_to inspection.number,
                                      inspection_path(inspection),
                                      data: { turbo_frame: "_top" },
                                      class: "text-blue-400 hover:text-blue-600" %>
                        </strong>
                      </td>

                      <td class="px-6 py-4 whitespace-normal break-words">
                        <strong class="text-white">
                          <%= link_to inspection.name,
                                      inspection_path(inspection),
                                      data: { turbo_frame: "_top" },
                                      class: "text-blue-400 hover:text-blue-600" %>
                        </strong>
                      </td>

                      <td class="px-6 py-4 whitespace-normal break-words">
                        <%= link_to inspection.item&.identificador, item_path(inspection.item), data: { turbo_frame: "_top" }, class: "text-blue-400 hover:text-blue-600" %>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <%= link_to inspection.item&.principal&.name, principal_path(inspection.item.principal), data: { turbo_frame: "_top" }, class: "text-blue-400 hover:text-blue-600" %>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <p class="text-white"><%= format_date(inspection.ins_date) %></p>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <p class="text-white"><%= inspection.result %></p>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <p class="text-white">
                          <%= (Date.current - inspection.cambio).to_i == 1 ? "1 d铆a" : "#{(Date.current - inspection.cambio).to_i} d铆as" %>
                        </p>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words">
                        <% if inspection.users.any? %>
                          <ul>
                            <% inspection.users.each do |user| %>
                              <li class="text-white"><%= user.real_name %></li>
                            <% end %>
                          </ul>
                        <% else %>
                          <p class="text-gray-400">No asignado</p>
                        <% end %>
                      </td>
                      <td class="px-6 py-4 whitespace-normal break-words text-center" data-order="<%= inspection.ins_date < Date.today ? 'Atrasada' : (inspection.ins_date == Date.today ? 'Hoy' : 'Pr贸xima') %>">
                        <span class="sr-only">
                          <% if inspection.ins_date < Date.today %>
                            Atrasada
                          <% elsif inspection.ins_date == Date.today %>
                            Hoy
                          <% else %>
                            Pr贸xima
                          <% end %>
                        </span>
                        <div class="relative group">
                          <% if inspection.ins_date < Date.today %>
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                              <circle cx="12" cy="12" r="5" fill="red" />
                            </svg>
                            <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
                              Inspecci贸n Atrasada
                            </span>
                          <% elsif inspection.ins_date == Date.today %>
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                              <circle cx="12" cy="12" r="5" fill="green" />
                            </svg>
                            <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
                              Agendada para hoy
                            </span>
                          <% else %>
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none" />
                              <circle cx="12" cy="12" r="5" fill="yellow" />
                            </svg>
                            <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block px-2 py-1 bg-gray-700 text-white text-sm rounded shadow-md">
                              Agendada para <%= format_date(inspection.ins_date) %>
                            </span>
                          <% end %>
                        </div>
                      </td>
                      <td class="px-6 py-4">
                        <%= link_to "Ver inspecci贸n", inspection_path(inspection), class: "text-blue-400 hover:text-blue-600", data: { turbo_frame: "_top" } %>
                      </td>
                    </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
              <script>
                  document.addEventListener("turbo:load", function() {
                      const tableEl = document.getElementById("inspections-table");
                      if (
                          tableEl &&
                          typeof simpleDatatables !== "undefined" &&
                          simpleDatatables.DataTable
                      ) {
                          const dataTable = new simpleDatatables.DataTable("#inspections-table", {
                              labels: {
                                  placeholder: "Buscar...",
                                  perPage: "registros por p谩g.",
                                  noRows: "No hay datos para mostrar",
                                  noResults: "No hay resultados que coincidan con tu b煤squeda",
                                  info: "Mostrando {start} a {end} de {rows} entradas"
                              },
                              tableRender: (_data, table, type) => {
                                  if (type === "print") {
                                      return table;
                                  }
                                  table.childNodes[0].childNodes.forEach((row) => {
                                      if (!row.attributes) row.attributes = {};
                                      row.attributes.class = (row.attributes.class || "") + " bg-gray-800 text-white";
                                      row.childNodes.forEach((th) => {
                                          if (!th.attributes) th.attributes = {};
                                          th.attributes.class = (th.attributes.class || "") + " bg-gray-800 text-white";
                                      });
                                  });
                                  const tHead = table.childNodes[0];
                                  const firstRow = tHead.childNodes[0];
                                  const filterHeaders = {
                                      nodeName: "TR",
                                      attributes: {
                                          class: "search-filtering-row bg-gray-800 text-white",
                                      },
                                      childNodes: firstRow.childNodes.map((_th, index) => ({
                                          nodeName: "TH",
                                          attributes: {
                                              style: "padding-top: 1rem;"
                                          },
                                          childNodes: [
                                              {
                                                  nodeName: "INPUT",
                                                  attributes: {
                                                      class: "datatable-input text-white placeholder-gray-400 bg-gray-700 border-gray-600 w-full",
                                                      type: "search",
                                                      "data-columns": "[" + index + "]",
                                                      placeholder: "Filtrar"
                                                  }
                                              }
                                          ]
                                      }))
                                  };
                                  tHead.childNodes.push(filterHeaders);
                                  return table;
                              }
                          });
                      }
                  });
              </script>
              <style>
                  .dataTable-table tbody td {
                      color: #fff !important;
                  }
                  .datatable-ascending,
                  .datatable-descending {
                      background-color: #539DED !important;
                      color: #fff !important;
                  }

                  #inspections-table thead th button.datatable-sorter {
                      background: transparent !important;
                      border: none !important;
                      color: #fff !important;
                  }

                  #inspections-table thead th button.datatable-sorter:hover {
                      background: transparent !important;
                      color: #1d4ed8 !important;
                  }

                  #inspections-table thead th button.datatable-sorter:hover::before,
                  #inspections-table thead th button.datatable-sorter:hover::after {
                      background-color: transparent !important;
                      color: #1d4ed8 !important;
                  }

                  #inspections-table thead th button.datatable-sorter:hover p.hover\:text-blue-700 {
                      color: #1d4ed8 !important;
                  }
                  #inspections-table .datatable-selector {
                      background-color: #f2f2f2 !important;
                      color: #000 !important;
                      border: 1px solid #ccc !important;
                      border-radius: 4px;
                      padding: 0.25rem 0.5rem;
                  }
                  #inspections-table .datatable-input {
                      background-color: #f2f2f2 !important;
                      color: #000 !important;
                      border: 1px solid #ccc !important;
                      border-radius: 4px;
                      padding: 0.25rem 0.5rem;
                  }
                  #inspections-table .datatable-input::placeholder {
                      color: #888;
                  }
              </style>
            <% else %>
              <%= render 'shared/search_form', form_url: home_path, search_keys: 'number_eq', frame_id: 'inspections', placeholder_text: 'n煤mero de inspecci贸n' %>

              <%= turbo_frame_tag "inspections-#{@pagy.page}", class: 'inspections' do %>
                <ul class="divide-y divide-gray-700">
                  <% @inspections.each_with_index do |inspection, index| %>
                    <li class="<%= 'bg-gray-700' if index.even? %> p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-150 ease-in-out">
                      <% border_class =
                           if inspection.ins_date < Date.today
                             "border border-red-600"
                           elsif inspection.ins_date == Date.today
                             "border border-green-500"
                           else
                             "border border-yellow-500"
                           end
                      %>
                      <div id="<%= dom_id inspection %>" class="max-w-md mx-auto bg-gray-900 rounded-xl shadow-lg overflow-hidden md:max-w-2xl <%= border_class %>">
                        <div class="p-8">
                          <p class="text-gray-400">
                            <strong class="text-gray-200 text-4xl">Inspecci贸n N掳: <%= inspection.number %></strong>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200 text-2xl">
                              Activo:
                              <%= link_to inspection.item&.identificador, item_path(inspection.item), class:"text-blue-500", data: { turbo_frame: "_top" } %>
                            </strong>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Empresa:</strong>
                            <%= link_to inspection.item&.principal&.name, principal_path(inspection.item.principal), class:"text-blue-500", data: { turbo_frame: "_top" } %>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Fecha de la inspecci贸n:</strong>
                            <%= format_date(inspection.ins_date) %>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Periodicidad:</strong>
                            <%= display_periodicity(inspection.validation) %>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Clasificaci贸n:</strong>
                            <%= inspection.item&.group&.name %>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Resultado de la inspecci贸n:</strong>
                            <%= inspection.result %>
                          </p>
                          <p class="text-gray-400">
                            <strong class="text-gray-200">Fecha de t茅rmino certificaci贸n:</strong>
                            <%= format_date(inspection.report&.ending) %>
                          </p>
                          <div class="mt-4">
                            <% if (controller_name == 'inspections' && action_name == 'index') ||
                              (controller_name == 'users' && action_name == 'show') ||
                              (controller_name == 'static_pages') ||
                              (controller_name == "home") %>
                              <%= link_to 'Ver inspecci贸n', inspection_path(inspection), class: "inline-block px-6 py-2 border border-blue-800 text-blue-400 font-medium text-xs leading-tight uppercase rounded hover:bg-blue-800 hover:text-white focus:outline-none focus:ring-0 transition duration-150 ease-in-out", 'data-turbo-frame': "_top" %>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    </li>
                  <% end %>
                </ul>
                <% if @pagy.next %>
                  <%= turbo_frame_tag "inspections-#{@pagy.next}", class: 'inspections', src: pagy_url_for(@pagy, @pagy.next), loading: :lazy %>
                <% end %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
